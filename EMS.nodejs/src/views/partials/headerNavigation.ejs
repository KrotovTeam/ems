<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script>

    $(document).ready(function () {
        //$.cookie.json = true;
        $('#loginform').submit(function (e) {
            e.preventDefault();
            $.ajax({
                type: "POST",
                url: '/auth/authenticate',
                data: {
                    username: $("#username").val(),
                    password: $("#password").val(),
                },
                success: function (data) {
                    if (data.code === 200) {
                        Cookies.set('user', data.data);
                        alert('Вы успешно авторизированы');
                        $("#123").replaceWith(`<div id="123"><p style="color:#f4fcff;font-size:14pt;">Вы авторизированы как ${data.data.username}  <button id="logout" type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-log-out"></span> Выйти</button> </p></div>`);
                    }
                    else {
                        alert('Ошибка авторизации');
                    }
                },
                error: function (err) {
                    console.log(err)
                    alert('Ошибка авторизации');
                }
            });
        });


        $("#logout").click(function () {
            Cookies.remove('user');
            $("#123").replaceWith(`<div id="123"><div class="form-group"><input type="text" class="form-control" name="username" id="username" placeholder="Логин"></div><div class="form-group"><input type="text" class="form-control" name="password" id="password" placeholder="Пароль"></div><button type="submit" class="btn btn-default">Войти</button></div>`);
        });

    });

</script>


<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">EMS</a>
        </div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="/">Главная</a></li>
            <li><a href="/map">Создать исследование</a></li>
            <li><a href="/research">Мои исследования</a></li>
        </ul>

        <form class="navbar-form navbar-right" role="search" id="loginform" action="/auth/login" method="post"
              enctype="multipart/form-data">
            <% if (!username){ %>
            <div id="123">
                <div class="form-group">
                    <input type="text" class="form-control" name="username" id="username" placeholder="Логин">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" name="password" id="password" placeholder="Пароль">
                </div>
                <button type="submit" class="btn btn-default">Войти</button>
            </div>
            <% }else{ %>
            <div id="123">
                <p style="color:#f4fcff;font-size:14pt;">Вы авторизированы как <%= username %>
                    <button id="logout" type="button" class="btn btn-default btn-sm">
                        <span class="glyphicon glyphicon-log-out"></span> Выйти
                    </button>
                </p>
                <% } %>
            </div>
        </form>

    </div>
</nav>
